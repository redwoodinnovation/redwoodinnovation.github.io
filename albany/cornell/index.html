<!DOCTYPE html>
<meta charset="utf-8">

<head>
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css"> 
</head>
<body>
    <h1> Cornell Elementary School </h1>
    <h2></h2>
  <div id="toggleContainer" class="container" style="top: 430px; left: 500px">
    <table>
      <tr>
        <td><label class="switch">
          <input id="l1_toggle" type="checkbox" checked>
          <div class="slider round"></div>
        </label></td>
        <td>Level 1 - CO2</td>
      </tr>
      <tr>
        <td><label class="switch">
          <input id="l0_toggle" type="checkbox" checked>
          <div class="slider round"></div>
        </label></td>
        <td>Level 0 - CO2</td>
      </tr>
      <tr>
        <td><label class="switch">
          <input id="elec_toggle" type="checkbox" checked>
          <div class="slider elec"></div>
        </label></td>
        <td>Electrical Meter</td>
      </tr>
      <tr>
        <td><label class="switch">
          <input id="h20_toggle" type="checkbox" checked>
          <div class="slider h20"></div>
        </label></td>
        <td>Water Meter</td>
      </tr>
      <tr>
        <td><label class="switch">
          <input id="gas_toggle" type="checkbox" checked>
          <div class="slider gas"></div>
        </label></td>
        <td>Gas Meter</td>
      </tr>
  </table>
  </div>

  <!-- Create an element where the map will take place -->
  <svg id="my_dataviz" width="500" height="900" style="transform: translate(0%, -25%);"></svg>

  <script>

  //---------//
  // GROUNDS //
  //---------// 

  // Svg
  var svg = d3.select("svg"),
  width = +svg.attr("width"),
  height = +svg.attr("height");

  // Map, projection, and centerpoint
  var path = d3.geoPath();
  var projection = d3.geoMercator()
    .scale(21000000)                          // Zoom
    .center([-122.29576905,37.890256])        // Geolocated centerpoint
    .translate([width / 3, height / 10]);

  var data = d3.map();
  var colorScale = d3.scaleThreshold()
    .domain([99, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500])
    .range(['#000000', '#870098', '#0000b1', '#002fdd', '#008add', '#00aa88', '#00d700', '#bcff00', '#f1e700', '#ffb500', '#ff1500', '#ff1736', '#ff3882', '#ff00ff', '#fac9fa', '#ffffff']);

  // Load external data and boot
  d3.queue()
    .defer(d3.json, "grounds.geojson")
    .defer(d3.csv, "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-d_NzjzpbEVKq66-RUzki_3-oo_lPvFHGhuIrOnMY-VIigGVjP2b5OqIJcaYolE-z88vxhaOGumut/pub?gid=1809780250&single=true&output=csv", function(d) { data.set(d.SchoolGroundsName, +d.co2ppm); })
    .await(ready);

  function ready(error, topo) {

  // Draw the map
  svg.append("g")
    .selectAll("path")
    .data(topo.features)
    .enter()
    .append("path")
    // draw each room
    .attr("d", d3.geoPath()
    .projection(projection)
      )
    // set the color of the area outline
    .attr("stroke","grey")
    .attr("stroke-width",0.5)
    // set the fill opacity of the areas
    .attr("fill-opacity",0.5)
    // set the color of each room
    .attr("fill", function (d) {
    d.total = data.get(d.id) || 0;
    return colorScale(d.total);
      });
  }

  </script>

  <script>

  //-------//
  // ROOMS //
  //-------// 

  // Svg
  var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

  // Map, projection, and centerpoint
  var path = d3.geoPath();
  var projection = d3.geoMercator()
   .scale(21000000)                          // Zoom
   .center([-122.29576905,37.890256])        // Geolocated centerpoint
   .translate([width / 3, height / 10]);

  var data = d3.map();
  var colorScale = d3.scaleThreshold()
    .domain([99, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500])
    .range(['#000000', '#870098', '#0000b1', '#002fdd', '#008add', '#00aa88', '#00d700', '#bcff00', '#f1e700', '#ffb500', '#ff1500', '#ff1736', '#ff3882', '#ff00ff', '#fac9fa', '#ffffff']);

  // Load external data and boot
  d3.queue()
    .defer(d3.json, "level0.geojson")
    .defer(d3.json, "level1.geojson")
    .defer(d3.csv, "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-d_NzjzpbEVKq66-RUzki_3-oo_lPvFHGhuIrOnMY-VIigGVjP2b5OqIJcaYolE-z88vxhaOGumut/pub?gid=1809780250&single=true&output=csv", function(d) { data.set(d.RoomNumber, +d.co2ppm); })
    .await(ready);

  function ready(error, level0, level1, topo) {
    if(error) {
      console.log(error);
    };

  // Draw Level0 map

  svg.append("g")
    .attr("class", "level0")
    .selectAll("path")
    .data(level0.features)
    .enter()
    .append("path")
      // draw each room
      .attr("d", d3.geoPath()
        .projection(projection)
      )
      // set the color of the area outline
      .attr("stroke","grey")
      .attr("stroke-width",0.5)
      // set the fill opacity of the areas
      .attr("fill-opacity",0.5)
      // set the color of each room
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      });
  
  // Draw Level1 map

  svg.append("g")
    .attr("class", "level1")
    .selectAll("path")
    .data(level1.features)
    .enter()
    .append("path")
      // draw each room
      .attr("d", d3.geoPath()
      .projection(projection)
      )
      // set the color of the area outline
      .attr("stroke","grey")
      .attr("stroke-width",0.5)
      // set the fill opacity of the areas
      .attr("fill-opacity",0.5)
      // set the color of each room
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      });
    }

    var l0_Checkbox = document.querySelector('input[id="l0_toggle"]');
    var l1_Checkbox = document.querySelector('input[id="l1_toggle"]');

    l0_Checkbox.onchange = function() {
      if(this.checked) {
        d3.selectAll(".level0").attr("visibility", "visible");
      } else {
        d3.selectAll(".level0").attr("visibility", "hidden");
      }
    };
    l1_Checkbox.onchange = function() {
      if(this.checked) {
        d3.selectAll(".level1").attr("visibility", "visible");
      } else {
        d3.selectAll(".level1").attr("visibility", "hidden");
      }
    }; 

  </script>

  <script>

    //------------------//
    // Electrical Meter //
    //------------------// 

    // The svg
    var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    // Map and projection
    var projection = d3.geoMercator()
        .scale(21000000)                      // Zoom
        .center([-122.29576905,37.890256])    // Geolocated centerpoint
        .translate([ width/3, height/4 ])

    d3.queue()
      .defer(d3.json, "grounds.geojson")        // GeoJSON shapes 
      .defer(d3.csv, "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-d_NzjzpbEVKq66-RUzki_3-oo_lPvFHGhuIrOnMY-VIigGVjP2b5OqIJcaYolE-z88vxhaOGumut/pub?gid=1224835953&single=true&output=csv")            // Location and size
      .await(ready);

    function ready(error, dataGeo, data) {

    // Add a scale for bubble size
      var valueExtent = d3.extent(data, function(d) { return +d.n; })
      var size = d3.scaleSqrt()
        .domain(valueExtent)                  // What's in the data
        .range([ 20, 30])                     // Size in pixel

    // Add circles:
    setTimeout(function(){
      svg
        .selectAll("myCircles")
        .data(data.sort(function(a,b) { return +b.n - +a.n }).filter(function(d,i){ return i<1000 }))
        .enter()
        .append("circle")
          .attr("class", "elecmeter")
          .attr("cx", function(d){ return projection([+d.lon, +d.lat])[0] })
          .attr("cy", function(d){ return projection([+d.lon, +d.lat])[1] })
          .attr("r", function(d){ return size(+d.n) })
          .style("fill", "red") 
          .attr("stroke", "white")
          .attr("stroke-width", 1)
          .attr("fill-opacity", 1)
    }, 500);

    var elec_Checkbox = document.querySelector('input[id="elec_toggle"]');

    elec_Checkbox.onchange = function() {
      if(this.checked) {
        d3.selectAll(".elecmeter").attr("visibility", "visible");
      } else {
        d3.selectAll(".elecmeter").attr("visibility", "hidden");
      }
    };
    }

  </script>

  <script>

    //-------------//
    // Water Meter //
    //-------------// 

    // The svg
    var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    // Map and projection
    var projection = d3.geoMercator()
        .scale(21000000)                      // Zoom
        .center([-122.29576905,37.890256])    // Geolocated centerpoint
        .translate([ width/3, height/4 ])

    d3.queue()
      .defer(d3.json, "grounds.geojson")        // GeoJSON shapes 
      .defer(d3.csv, "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-d_NzjzpbEVKq66-RUzki_3-oo_lPvFHGhuIrOnMY-VIigGVjP2b5OqIJcaYolE-z88vxhaOGumut/pub?gid=1770914976&single=true&output=csv")            // Location and size
      .await(ready);

    function ready(error, dataGeo, data) {

    // Add a scale for bubble size
      var valueExtent = d3.extent(data, function(d) { return +d.n; })
      var size = d3.scaleSqrt()
        .domain(valueExtent)                  // What's in the data
        .range([ 20, 30])                     // Size in pixel

    // Add circles:
    setTimeout(function(){
      svg
        .selectAll("myCircles")
        .data(data.sort(function(a,b) { return +b.n - +a.n }).filter(function(d,i){ return i<1000 }))
        .enter()
        .append("circle")
          .attr("class", "h20meter")
          .attr("cx", function(d){ return projection([+d.lon, +d.lat])[0] })
          .attr("cy", function(d){ return projection([+d.lon, +d.lat])[1] })
          .attr("r", function(d){ return size(+d.n) })
          .style("fill", "blue") 
          .attr("stroke", "white")
          .attr("stroke-width", 1)
          .attr("fill-opacity", 1)
    }, 500);

    var h20_Checkbox = document.querySelector('input[id="h20_toggle"]');

    h20_Checkbox.onchange = function() {
      if(this.checked) {
        d3.selectAll(".h20meter").attr("visibility", "visible");
      } else {
        d3.selectAll(".h20meter").attr("visibility", "hidden");
      }
    };
  }

</script>

<script>

    //-----------//
    // Gas Meter //
    //-----------// 

    // The svg
    var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    // Map and projection
    var projection = d3.geoMercator()
        .scale(21000000)                      // Zoom
        .center([-122.29576905,37.890256])    // Geolocated centerpoint
        .translate([ width/3, height/4 ])

    d3.queue()
      .defer(d3.json, "grounds.geojson")        // GeoJSON shapes 
      .defer(d3.csv, "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-d_NzjzpbEVKq66-RUzki_3-oo_lPvFHGhuIrOnMY-VIigGVjP2b5OqIJcaYolE-z88vxhaOGumut/pub?gid=1464833914&single=true&output=csv")            // Location and size
      .await(ready);

    function ready(error, dataGeo, data) {

    // Add a scale for bubble size
      var valueExtent = d3.extent(data, function(d) { return +d.n; })
      var size = d3.scaleSqrt()
        .domain(valueExtent)                  // What's in the data
        .range([ 20, 30])                     // Size in pixel

    // Add circles:
    setTimeout(function(){
      svg
        .selectAll("myCircles")
        .data(data.sort(function(a,b) { return +b.n - +a.n }).filter(function(d,i){ return i<1000 }))
        .enter()
        .append("circle")
          .attr("class", "gasmeter")
          .attr("cx", function(d){ return projection([+d.lon, +d.lat])[0] })
          .attr("cy", function(d){ return projection([+d.lon, +d.lat])[1] })
          .attr("r", function(d){ return size(+d.n) })
          .style("fill", "yellow") 
          .attr("stroke", "white")
          .attr("stroke-width", 1)
          .attr("fill-opacity", 1)
    }, 500);

    var gas_Checkbox = document.querySelector('input[id="gas_toggle"]');

    gas_Checkbox.onchange = function() {
      if(this.checked) {
        d3.selectAll(".gasmeter").attr("visibility", "visible");
      } else {
        d3.selectAll(".gasmeter").attr("visibility", "hidden");
      }
    };
  }

</script>

// CO2 Gradient  

<svg width="600" height="92.26" clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 900 92.26" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" style="transform: translate(5%, -180%);">
    
    <g transform="matrix(.080736 0 0 .074478 -75.283 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#870098"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 -17.175 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#0000b1"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 40.933 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#002fdd"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 99.042 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#008add"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 157.15 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#00aa88"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 215.26 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#00d700"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 273.37 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#bcff00"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 331.47 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#f1e700"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 389.58 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#ffb500"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 447.69 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#ff1500"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 505.8 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#ff1736"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 563.91 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#ff3882"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 622.01 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#ff00ff"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 680.12 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#fac9fa"/>
    </g>
    <g transform="matrix(.080736 0 0 .074478 738.23 -331.99)">
        <rect x="1180.2" y="4792.8" width="575.78" height="624.17" fill="#ffffff"/>
    </g>
    <g transform="matrix(.19679 0 0 .19679 -198.01 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">100</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 -198.34 -880.27)" fill="#ffffff" font-size="100px">
        <text x="1144.76" y="4545.8599" font-family="Arial-BoldMT, Arial, sans-serif" font-weight="700">CO</text>
        <text x="1294.76" y="4545.8599" font-family="LucidaGrande-Bold, 'Lucida Grande', sans-serif" font-weight="600">₂</text>
        <text x="1370.74" y="4545.8599" font-family="Arial-BoldMT, Arial, sans-serif" font-weight="700">PPM</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 -139.4 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">200</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 -81.802 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">300</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 -23.885 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">400</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 33.907 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">500</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 91.973 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">600</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 150.27 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">700</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 208.34 -802.58)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">800</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 266.29 -802.59)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">900</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 318.48 -802.59)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">1000</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 376.26 -802.59)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">1<tspan x="1194.86 1250.47" y="4545.8599 4545.8599">10</tspan>0</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 434.05 -802.59)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">1200</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 492.78 -802.57)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">1300</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 550.78 -802.59)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">1400</text>
    </g>
    <g transform="matrix(.19679 0 0 .19679 609.92 -802.59)">
        <text x="1144.76" y="4545.8599" fill="#ffffff" font-family="Arial-BoldMT, Arial, sans-serif" font-size="100px" font-weight="700">1500</text>
    </g>
</svg>

</body>
